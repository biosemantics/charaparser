# Architecture Overview

## Table of contents
   * [Introduction](#introduction)
   * [Entry-point & Configuration & Run](#entry-point--configuration--run)
   * [Learn](#learn)
   * [Markup](#markup)
   * [Markup Creation](#markup-creation)

## Introduction
The Charaparser framework allows for different types of executions and is highly configurable to the a very detailed processing level. To configure Charaparser for a specific execution the dependency injection framework [Guice](https://github.com/google/guice) is utilized. 

On a high level, it can for example be executed to 
* markup descriptions \[[0](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/run/etc/ETCMarkupRun.java )\]
* to evaluate created markup \[[1](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/markupelement/description/run/DescriptionEvaluationRun.java)\]
* or others [[2](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/markupelement/description/run/DescriptionMarkupAndDescriptionMarkupEvaluationRun.java ), [3](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/markupelement/description/run/DescriptionMarkupRun.java ), [4](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/run/etc/ETCLearnRun.java ), ...]. 

On another level it may for example be configured to markup descriptions of type
* morphology \[[5](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/markupelement/description/markup/DescriptionMarkupCreator.java )\] 
* habitat \[[6](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/markupelement/habitatDescr/markup/HabitatMarkupCreator.java )\] 
* elevation \[[7](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/markupelement/elevation/markup/ElevationMarkupCreator.java)\]
* phenology \[[8](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/markupelement/phenology/markup/PhenologyMarkupCreator.java)\]
* ecology \[[9](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/markupelement/ecology/markup/EcologyMarkupCreator.java)\]
* distribution \[[10](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/markupelement/distribution/markup/DistributionMarkupCreator.java)\]. 

Also the strategies used to markup any of these types can be varied, up to very fine granular details, such as which measurement units are supported (cm, dm, m, etc.) \[[11](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/config/BasicConfig.java#L330)\]. 

The JavaDoc of the project can be found [here](http://biosemantics.github.io/charaparser/apidocs/index.html).

## Entry-point & Configuration & Run
The following two diagrams illustrate the utilization of the injection framework. [AbstractModule](https://google.github.io/guice/api-docs/latest/javadoc/index.html?com/google/inject/AbstractModule.html) is a Guice class utilized to create the injection bindings. The hierarchy inheriting AbstractModule merely layers configuration options of CharaParser by detail level (i.e. BaseConfig \[[12](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/config/BasicConfig.java)\] contains parameters that likely do not vary, while RunConfig \[[13](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/config/RunConfig.java)\] contains parameters that frequently change between runs) and finally taxon groups \[[14](https://github.com/biosemantics/charaparser/tree/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/config/taxongroup)\]. A command line interface (CLI) entry point \[[15](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/CLIMain.java)\] may parse \[[16](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/CLIMain.java#L96)\] command line options and parameters to update the configuration for the run according to users inputs. Eventually a IRun will be created \[[17](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/CLIMain.java#L72)\] to execute the desired run configuration.

![Run and Guice Configuration][Run]
![ETCLearnMain][ETCLearnMain]

## Learn
ETCLearnRun \[[18](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/run/etc/ETCLearnRun.java)\] is one IRun \[[19](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/run/IRun.java)\] example that is used for illustration in the following. For the markup of morphological descriptions it is required to learn the terminology used in the description. This is done by ETCLearnRun. To achieve this it will learn using OTOLearner \[[20](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/markupelement/description/ling/learn/lib/OTOLearner.java)\]. OTOLearner reads the descriptions, e.g. from XML files and returns the model class DescriptionsFilesList \[[21](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/markupelement/description/model/DescriptionsFileList.java)\]. It will then retrieve a glossary for the taxon group configured from [OTO](https://github.com/biosemantics/oto/tree/master/oto) and subsequently initialize an in memory glossary with the retrieved data. An instance of ITerminologyLearner \[[22](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/markupelement/description/ling/learn/ITerminologyLearner.java)\] will proceed with the actual learning of terminology from the DescriptionsFileList. Finally OTOLearner will send the the collection of terminology found for review and corrective relabeling to [OTO2](https://github.com/biosemantics/oto2/tree/master/oto), the term categorization application.

![ETCLearnRun][ETCLearnRun]

## Markup
ETCLearnRun \[[23](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/run/etc/ETCLearnRun.java )\] is usually only run in conjunction with ETCMarkupRun \[[24](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/run/etc/ETCMarkupRun.java )\], another IRun option. ETCMarkupRun utilizes a MarkupChain \[[25](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/markup/MarkupChain.java)\] that trigger the creation of markup for a configured set of description types. 

![ETCMarkupRun][ETCMarkupRun]

## Markup Creation
The currently available IMarkupCreator \[[26](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/markup/IMarkupCreator.java), [27](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/markupelement/description/markup/DescriptionMarkupCreator.java), [28](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/markupelement/elevation/markup/ElevationMarkupCreator.java), [29](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/markupelement/ecology/markup/EcologyMarkupCreator.java), [30](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/markupelement/habitatDescr/markup/HabitatMarkupCreator.java), [31](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/markupelement/distribution/markup/DistributionMarkupCreator.java), [32](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/markupelement/phenology/markup/PhenologyMarkupCreator.java)\], on a high level, all very much behave the same way. They read the type of description which they are supposed to transform. They will do the transformation and they will write the transformed description back to the source, e.g. an XML file. To illustrate this take a look at the DescriptionMarkupCreator \[[33](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/markupelement/description/markup/DescriptionMarkupCreator.java)\] (This is the markup creator for descriptions of type morphology). DescriptionMarkupCreator will loop over a set of configured IDescriptionTransformer \[[34](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/markupelement/description/transform/IDescriptionTransformer.java)\] to create the transformed morphological description. For example, a first transformer may extract create biological entities and their characters from a piece of text, while a subsequent transformer may map biological entities found to IRIs in ontologies available.

![DescriptionMarkupCreator][DescriptionMarkupCreator]

The following illustrates the markup creation specific to morphological descriptions. It is very much simpler for any of the other description types and thus not further discussed.

To dive deeper for morphological descriptions, let's take a look at the IDescriptionTransformer \[[35](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/markupelement/description/transform/IDescriptionTransformer.java)\] that is MarkupDescriptionTreatmentTransformer \[[36](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/markupelement/description/transform/MarkupDescriptionTreatmentTransformer.java)\]. This transformer will retrieve the glossary for the specific taxon group from [OTO](https://github.com/biosemantics/oto/tree/master/oto) and additionally retrieve the reviewed term categorizations from the learn step discussed previously. It will initialize an in-memory glossary from these two data sources and learn using an instance of DatabaseInputNoLearner \[[37](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/markupelement/description/ling/learn/lib/DatabaseInputNoLearner.java)\]. As the name suggested this is not actually learning terminology but rather initializing a required database. Finally for all descriptions to be transformed it will extract the description markup using a DescriptionExtractorRun \[[38](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/markupelement/description/transform/DescriptionExtractorRun.java)\].

![MarkupDescriptionTreatmentTransformer][MarkupDescriptionTreatmentTransformer]

DescriptionExtractorRun \[[39](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/markupelement/description/transform/DescriptionExtractorRun.java)\] loops over all sentences and chunks each one of them resulting in a ChunkCollector \[[40](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/ling/chunk/ChunkCollector.java)\]. Once complete, it extracts the marked up description using all the ChunkCollectors.

![DescriptionExtractorRun][DescriptionExtractorRun]

To do the chunking of a sentence, in detail, SentenceChunkerRun \[[41](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/markupelement/description/transform/SentenceChunkerRun.java)\] normalizes, tokenizes, tags, and parses the sentence. In the last step a ChunkerChain \[[42](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/ling/chunk/ChunkerChain.java)\] chunks the sentence resulting in a ChunkCollector \[[43](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/ling/chunk/ChunkCollector.java)\].

![SentenceChunkerRun][SentenceChunkerRun]

To extract the marked up description using all the ChunkCollectors \[[44](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/ling/chunk/ChunkCollector.java)\] of a single description, in detail, the SomeDescriptionExtractor \[[45](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/markupelement/description/ling/extract/lib/SomeDescriptionExtractor.java)\] first creates a ProcessingContext \[[46](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/markupelement/description/ling/extract/ProcessingContext.java)\]. It will iterate all ChunkCollectors, each of them corresponding to one of the sentences in the description. It will initialize the ProcessingContext for the new sentence by resetting and setting the ChunkCollector. It will get and loop over all the chunks of the sentence, obtain the IChunkProcessor \[[47](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/ling/extract/IChunkProcessor.java)\] from ChunkProcessorProvider \[[48](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/markupelement/description/ling/extract/lib/ChunkProcessorProvider.java)\] as adequate for the ChunkType \[[49](https://github.com/biosemantics/charaparser/blob/master/src/main/java/edu/arizona/biosemantics/semanticmarkup/ling/chunk/ChunkType.java)\] at hand and process it resulting in a set of Elements. This concludes the markup process of morphological descriptions on a high level.

![SomeDescriptionExtractor][SomeDescriptionExtractor]

[Run]: http://biosemantics.github.io/charaparser/Run.png "Run and Guice Configuration"
[ETCLearnMain]: http://biosemantics.github.io/charaparser/ETCLearnMain.png "ETCLearnMain"
[ETCLearnRun]: http://biosemantics.github.io/charaparser/ETCLearnRun.png "ETCLearnRun"
[ETCMarkupRun]: http://biosemantics.github.io/charaparser/ETCMarkupRun.png "ETCMarkupRun"
[DescriptionMarkupCreator]: http://biosemantics.github.io/charaparser/DescriptionMarkupCreator.png "DescriptionMarkupCreator"
[MarkupDescriptionTreatmentTransformer]: http://biosemantics.github.io/charaparser/MarkupDescriptionTreatmentTransformer.png "MarkupDescriptionTreatmentTransformer"
[DescriptionExtractorRun]: http://biosemantics.github.io/charaparser/DescriptionExtractorRun.png "DescriptionExtractorRun"
[SomeDescriptionExtractor]: http://biosemantics.github.io/charaparser/SomeDescriptionExtractor.png "SomeDescriptionExtractor"
[SentenceChunkerRun]: http://biosemantics.github.io/charaparser/SentenceChunkerRun.png "SentenceChunkerRun"
